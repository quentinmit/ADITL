#!/usr/bin/perl

use strict;

use lib "/usr/local/aditl2/perl/lib";
use Database;
use Settings;
use Template;
use Utils;
use Colors;
use Cookie;

use CGI qw(-debug :standard);
$CGI::DISABLE_UPLOADS = 1;

use vars qw($cgi $db);

$cgi = new CGI;

$db = Database->new();
$db->connect("aditl2");

my @uids;
for(my $i = 0; $i < 4; $i++) {
    my $j = $i+1;
    $uids[$i] = $cgi->param("uid$j");
}

my $start = 720;
my $uidstring = "uid1=$uids[0]\&uid2=$uids[1]\&uid3=$uids[2]\&uid4=$uids[3]";

my @initFrags;

for(my $i = 0; $i < 6; $i++) {
    my $t = "";
    
    my $end = $start + 15;

    $t .= Settings::settings("htmlFragmentURL");
    $t .= "?$uidstring\&start=$start\&end=$end";

    $initFrags[$i] = $t;

    $start += 15;
}

push(@initFrags, Settings::settings("htmlFragmentURL") . "?" . $uidstring);

my $html = Template::fillTemplate(Settings::settings("templateLib") . "/timeline.html", \@initFrags);

print $cgi->header();
print $html;
exit;

